<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    {% if page %}
        <meta name="description" content="The community-managed Bus Simulator Wiki!">
        <meta name="keywords" content="{{ page['keywords'] }}">

        <title>{{ page["title"] }} - Bus Simulator Community Wiki</title>

        <link rel="icon" href="/bussim-assets/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="/bussim-assets/style.css">
    {% endif %}

    <link rel="preload" as="image" href="/bussim-assets/images/banner.jpg">

    <audio id="soundSource" controls autoplay style="display: none;">
        <source type="audio/mp3">
    </audio>
</head>
<body>
    <div id="sidebar" class="sidebar" style="z-index: 999;">
        <div id="mainMenu" class="sidebarMenu" style="display: block;">
            <button onclick="location.href='/bussim/'">
                <img src="/assets/home.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Home</text>
            </button>
        
            <button onclick="navigateMenu('wikiPages')">
                <img src="/assets/books.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Wiki</text>
            </button>
        
            <button onclick="navigateMenu('otherStuff')">
                <img src="/assets/others.png" style="rotate: 90deg; user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Other Stuff</text>
            </button>
        </div>
        
        <div id="wikiPages" class="sidebarMenu" style="display: none;">
            <button onclick="navigateMenu('mainMenu')" type="menuBack">
                <img src="/assets/back.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Back to Menu</text>
            </button>
        
            <button onclick="location.href='/bussim/events'">
                <text style="margin-top: 3px; margin-left: 13px; font-size: 17px;">?</text>
                <text type="hoverText">Events</text>
            </button>
        
            <button onclick="location.href='/bussim/biomes'">
                <text style="margin-top: 3px; margin-left: 13px; font-size: 17px;">?</text>
                <text type="hoverText">Biomes</text>
            </button>
        
            <button onclick="location.href='/bussim/items'">
                <text style="margin-top: 3px; margin-left: 13px; font-size: 17px;">?</text>
                <text type="hoverText">Items</text>
            </button>
        
            <button onclick="location.href='/bussim/locations'">
                <text style="margin-top: 3px; margin-left: 13px; font-size: 17px;">?</text>
                <text type="hoverText">Locations</text>
            </button>
        
            <button onclick="location.href='/bussim/npcs'">
                <text style="margin-top: 3px; margin-left: 13px; font-size: 17px;">?</text>
                <text type="hoverText">NPCs</text>
            </button>
        
            <button onclick="location.href='/bussim/others'">
                <text style="margin-top: 3px; margin-left: 13px; font-size: 17px;">?</text>
                <text type="hoverText">Others</text>
            </button>
        </div>
        
        <div id="otherStuff" class="sidebarMenu" style="display: none;">
            <button onclick="navigateMenu('mainMenu')" type="menuBack">
                <img src="/assets/back.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Back to Menu</text>
            </button>
        
            <button onclick="location.href='/bussim/editing'">
                <img src="/assets/edit.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Wiki Editing</text>
            </button>
        
            <button onclick="location.href='/bussim/contributors'">
                <img src="/assets/contributors.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Contributors</text>
            </button>
        
            <button onclick="window.open('https://github.com/FrostBitten-Wiki/bussim', '_blank')">
                <img src="/assets/github.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Wiki Repository</text>
            </button>
        </div>
        
        <bottomButtons>
            <button onclick="randomDialogueEvent(true)">
                <img src="/assets/books.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Force Dialogue</text>
            </button>
        
            <button onclick="window.open('https://discord.gg/frostbitegames', '_blank')">
                <img src="/assets/discord.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">FrostBitten Games</text>
            </button>
        
            <button onclick="window.open('https://discord.gg/pNnMKKg', '_blank')">
                <img src="/assets/discord.png" style="user-select: none; margin-left: 7px;" width="24" height="auto">
                <text type="hoverText">Bus Simulator Discord</text>
            </button>
        </bottomButtons>
        
        <script>
            var activeMenu = "mainMenu";

            function navigateMenu(menuId) {
                var menus = document.querySelectorAll('.sidebarMenu');
                menus.forEach(function(menu) {
                    menu.style.display = 'none';
                });
            
                var selectedMenu = document.getElementById(menuId);
                if (selectedMenu) {
                    selectedMenu.style.display = 'block';
                    activeMenu = menuId;
                }
            }

            navigateMenu(activeMenu);
        </script>
    </div>

    <div>
    </div>
    
    {% if html %}
    <div style="margin-left: 60px; min-height: 100vh; overflow-y: auto;">
        <div style="position: relative; height: 100%; user-select: none;">
            <img src="{{ html['header']['imageBanner'] }}" width="100%" height="200px" style="object-fit: cover; user-select: none;">
            <div style="position: absolute; top: 0; height: 200px; width: calc(100vw - 60px); background: linear-gradient(to bottom, transparent 0%, rgba(8, 4, 83, 1) 50%); z-index: 1;"></div>

            {% if html['header']['image'] == "" %}
                <div style="position: absolute; top: 60px; margin-left: 5vw; margin-right: 5vw; z-index: 2;">
                    <text style="font-size: 50px;">{{ html["header"]["title"] }}</text><br>
                    <text style="font-size: 20px;">{{ html["header"]["description"] }}</text>
                </div>
            {% elif html['header']['image'] != "" %}
                <div style="position: absolute; top: 60px; margin-left: 5vw; margin-right: 5vw; z-index: 2; display: grid; grid-template-columns: 66px 1fr; gap: 10px;">
                    <img src="{{ html['header']['image'] }}" width="66" height="auto">
                    <div>
                        <text style="font-size: 50px;">{{ html["header"]["title"] }}</text><br>
                        <text style="font-size: 20px;">{{ html["header"]["description"] }}</text>
                    </div>
                </div>
            {% endif %}
        </div>

        <div style="margin-left: 5vw; margin-right: 5vw;">
            <!-- Custom Jinja2 Functions -->
            {% macro render_tree(node) %}
                {% if node %}
                    <ul>
                        {% for item in node %}
                            <li>
                                {{ item["name"] }}
                                {{ render_tree(item["children"]) }}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endmacro %}

            <div>
                {% for data in html['pageContent'] %}
                    {% if data['type'] == "text" %}
                        <text>{{ data['content']['text'] }}</text>
                    {% elif data['type'] == "section" %}
                        <div style="margin-top: 20px; margin-bottom: 20px;">
                            <text style="font-size: 25px;">{{ data['content']['sectionTitle'] }}</text><br>
                            <text>{{ data['content']['sectionDescription'] }}</text>
                        </div>
                    {% elif data['type'] == "list" %}
                        <div style="margin-top: 20; margin-bottom: 20px;">
                            {% for item in data['content']['items'] %}
                                {% if item['listItemRedirect'] == "" %}
                                    {% if item['listItemImage'] == "" %}
                                        <div class="container" style="padding: 10px;">
                                            <text style="font-size: 25px;">{{ item['listItemTitle'] }}</text><br>
                                            <text>{{ item['listItemDescription'] }}</text>
                                        </div>
                                    {% elif item['listItemImage'] != ""%}
                                        <div class="container" style="padding: 10px; display: grid; grid-template-columns: 128px 1fr; gap: 10px;">
                                            <img src="{{ item['listItemImage'] }}" height="128" width="128" style="object-fit: cover;" loading="lazy">

                                            <div>
                                                <text style="font-size: 25px;">{{ item['listItemTitle'] }}</text><br>
                                                <text>{{ item['listItemDescription'] }}</text>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% elif item['listItemRedirect'] != "" %}
                                    {% if item['listItemImage'] == "" %}
                                        <div class="container" style="padding: 10px; cursor: pointer;" onclick="location.href=`{{ item['listItemRedirect'] }}`">
                                            <text style="font-size: 25px;">{{ item['listItemTitle'] }}</text><br>
                                            <text>{{ item['listItemDescription'] }}</text>
                                        </div>
                                    {% elif item['listItemImage'] != ""%}
                                        <div class="container" style="padding: 10px; cursor: pointer; display: grid; grid-template-columns: 128px 1fr; gap: 10px;" onclick="location.href=`{{ item['listItemRedirect'] }}`">
                                            <img src="{{ item['listItemImage'] }}" height="128" width="128" style="object-fit: cover;" loading="lazy">

                                            <div>
                                                <text style="font-size: 25px;">{{ item['listItemTitle'] }}</text><br>
                                                <text>{{ item['listItemDescription'] }}</text>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% elif data['type'] == "infobox" %}
                        <div class="container" style="padding: 10px;">
                            <text style="color: {{ data["content"]["infoBoxTitle"][1] }}; font-size: 25px;">{{ data["content"]["infoBoxTitle"][0] }}</text><br>
                            <text>{{ data["content"]["infoBoxDescription"]}}</text>
                        </div>
                    {% elif data['type'] == "tree" %}
                        <div style="margin-top: 20px; margin-bottom: 20px;">
                            {{ render_tree(data['content']) }}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>

            {% if attributions != [] %}
            <div style="margin-top: 10px; margin-bottom: 20px;">
                {% for attr in attributions %}
                    <text style="font-size: 10px;">{{ attr }}</text><br>
                {% endfor %}
            </div>
            {% endif %}
            
        </div>
    </div>
    {% endif %}

    <div id="speakerPopup" class="checkBg" style="transition: bottom 1s; user-select: none; --color1: #6d6d6d; --color2: #9d9d9d; --color3: white; position: fixed; bottom: -165px; right: 10px; width: 550px; height: 110px; gap: 10px;" id="tips">
        <text id="speakerId" style="position: absolute; top: -15px; left: 0; font-size: 10px; opacity: 0.3;"></text>
        <div id="" style="display: grid; grid-template-columns: 1fr 150px;">
            <div style="padding: 10px;">
                <text id="speakerName" style="font-size: 23px;"></text><br>
                <text id="speakerText"></text>
            </div>

            <img id="speakerImage" src="" width="150" height="150" style="object-fit: cover; position: absolute; bottom: 0; right: 0;" >
        </div>
    </div>

    <!-- <script src="/bussim-assets/scripts/imagePreloader.js" async></script> -->
    <script src="/bussim-assets/scripts/dialogueSystem.js" defer></script>
</body>
</html>
